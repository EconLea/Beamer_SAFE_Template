% Gemini theme (modified for pdfLaTeX and serif fonts)

% ====================
% Dependencies
% ====================

\RequirePackage{exscale}
\RequirePackage{ragged2e}
\RequirePackage{changepage}
\RequirePackage{calc}
\RequirePackage{hyperref}
\RequirePackage{etoolbox}

% ====================
% Font Setup (pdfLaTeX-compatible)
% ====================

\usefonttheme{default}

\setbeamerfont{headline}{family=\rmfamily}
\setbeamerfont{headline title}{size=\Huge,series=\bfseries}
\setbeamerfont{headline author}{size=\Large}
\setbeamerfont{headline institute}{size=\normalsize}
\setbeamerfont{block title}{family=\rmfamily,size=\large,series=\bfseries}
\setbeamerfont{heading}{family=\rmfamily,series=\bfseries}
\setbeamerfont{caption}{size=\small}
\setbeamerfont{footline}{family=\rmfamily,size=\normalsize}
\setbeamerfont{block body}{size=\normalsize}

% set manual header margins as we avoid \logoleft and \logoright
% this correctly centers header 
% Define logo height (user-settable)
\newlength{\logoheight}
\setlength{\logoheight}{5cm}  % You can change this freely

% Define margins (we'll calculate them next)
\newlength{\manualheadmarginleft}
\newlength{\manualheadmarginright}

% Temp variables to help with ratio-based calculation
\newlength{\templen}

% Compute: marginleft = logoheight × (960 / 524) ≈ 1.8328
\setlength{\templen}{\logoheight}
\setlength{\manualheadmarginleft}{1.8328\templen}

% Compute: marginright = logoheight × (1) = logoheight
\setlength{\manualheadmarginright}{\logoheight}
% Add a minimum space between logo and header 
\addtolength{\manualheadmarginleft}{0.5cm}
\addtolength{\manualheadmarginright}{0.5cm}

% Define consistent vertical baseline of header text and logo to top of page
\newlength{\headeroffset}
\setlength{\headeroffset}{1.7cm}  % the desired top margin from the page top


% ====================
% Macros
% ====================

\newcommand{\samelineand}{\qquad}

% ====================
% Elements
% ====================

% List
\def\@listi{\leftmargin\leftmargini
\topsep 1ex
\parsep 0\p@ \@plus\p@
\itemsep 0.5ex}

% Itemize
\setbeamertemplate{itemize item}{\raise0.5ex \hbox{\vrule width 0.5ex height 0.5ex}}
\setbeamertemplate{itemize subitem}{\raise0.3ex \hbox{\vrule width 0.5ex height 0.5ex}}
\setbeamertemplate{itemize subsubitem}{\raise0.2ex \hbox{\vrule width 0.5ex height 0.5ex}}

% Enumerate
\setbeamertemplate{enumerate item}{\insertenumlabel.}
\setbeamertemplate{enumerate subitem}{\insertsubenumlabel.}
\setbeamertemplate{enumerate subsubitem}{\insertsubsubenumlabel.}

% Equation
\setlength\belowdisplayshortskip{2ex}

% Caption
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}[period]
\setlength{\abovecaptionskip}{2ex}
\setlength{\belowcaptionskip}{1ex}

% Bibliography
\setbeamertemplate{bibliography item}[text]
\hypersetup{
  colorlinks=true,
  citecolor=safeblue,
  urlcolor=black
}
\AtBeginBibliography{%
  \setlength{\itemsep}{1.5ex}  % increase space between bibliography entries
}

% Navigation
\beamertemplatenavigationsymbolsempty

% ====================
% Components
% ====================

% Heading
\newcommand\heading[1]{%
  \par\bigskip
  {\usebeamerfont{heading}\usebeamercolor[fg]{heading}#1}\par\smallskip
}

% Logo setup
\newlength{\logoleftwidth}
\setlength{\logoleftwidth}{0cm}
\newlength{\logorightwidth}
\setlength{\logorightwidth}{0cm}
\newlength{\maxlogowidth}
\setlength{\maxlogowidth}{0cm}

\newcommand{\logoright}[1]{%
  \newcommand{\insertlogoright}{#1}
  \settowidth{\logorightwidth}{\insertlogoright}
  \addtolength{\logorightwidth}{10ex}
  \setlength{\maxlogowidth}{\maxof{\logoleftwidth}{\logorightwidth}}
}
\newcommand{\logoleft}[1]{%
  \newcommand{\insertlogoleft}{#1}
  \settowidth{\logoleftwidth}{\insertlogoleft}
  \addtolength{\logoleftwidth}{10ex}
  \setlength{\maxlogowidth}{\maxof{\logoleftwidth}{\logorightwidth}}
}

% Headline
\setbeamertemplate{headline}{%
  \begin{beamercolorbox}{headline}
    \begin{columns}
      \begin{column}{\manualheadmarginleft} %\maxlogowidth
        \vspace*{\headeroffset}  % ensure alignment with logos
        \ifdefined\insertlogoleft
        \vspace*{\fill}
        \hspace{10ex}
        \raggedright
        \insertlogoleft
        \vspace*{\fill}
        \fi
      \end{column}
      \begin{column}{\dimexpr\paperwidth - \manualheadmarginleft - \manualheadmarginright} % use custom margins
      %\begin{column}{\dimexpr\paperwidth-\maxlogowidth-\maxlogowidth}
        \usebeamerfont{headline}
 	\vskip3ex
        \centering
        \ifx \inserttitle \empty \else
        {\usebeamerfont{headline title}\usebeamercolor[fg]{headline title}\inserttitle\\[0.5ex]}
        \fi
        \ifx \beamer@shortauthor \empty \else
        {\usebeamerfont{headline author}\usebeamercolor[fg]{headline author}\insertauthor\\[1ex]}
        \fi
        \ifx \insertinstitute \empty \else
        {\usebeamerfont{headline institute}\usebeamercolor[fg]{headline institute}\insertinstitute\\[1ex]}
        \fi
      \end{column}
      \begin{column}{\manualheadmarginright} %\maxlogowidth
        \vskip5ex
        \ifdefined\insertlogoright
        \vspace*{\fill}
        \raggedleft
        \insertlogoright
        \hspace{10ex}
        \vspace*{\fill}
        \fi
      \end{column}
    \end{columns}
    \vspace{5ex}
    \ifbeamercolorempty[bg]{headline rule}{}{\begin{beamercolorbox}[wd=\paperwidth,colsep=0.5ex]{headline rule}\end{beamercolorbox}}
  \end{beamercolorbox}
}

% Block styles
\setbeamertemplate{block begin}{%
  \begin{beamercolorbox}[colsep*=0ex,dp=2ex,center]{block title}
    \vskip0pt
    \usebeamerfont{block title}\insertblocktitle
    \vskip-1.25ex
    \begin{beamercolorbox}[colsep=0.025ex]{block separator}\end{beamercolorbox}
  \end{beamercolorbox}
  {\parskip0pt\par}
  \usebeamerfont{block body}
  \vskip-0.5ex
  \begin{beamercolorbox}[colsep*=0ex]{block body}
  \justifying
  \setlength{\parskip}{1ex}
  \vskip-2ex
}
\setbeamertemplate{block end}{%
  \end{beamercolorbox}
  \vskip0pt
  \vspace*{2ex}
}

% Alert block
\setbeamertemplate{block alerted begin}{%
  \begin{beamercolorbox}[colsep*=0ex,dp=2ex,center]{block alerted title}
    \vskip0pt
    \usebeamerfont{block title}\insertblocktitle
    \vskip-1.25ex
    \begin{beamercolorbox}[colsep=0.025ex]{block alerted separator}\end{beamercolorbox}
  \end{beamercolorbox}
  {\parskip0pt\par}
  \usebeamerfont{block body}
  \vskip-0.5ex
  \begin{beamercolorbox}[colsep*=0ex]{block alerted body}
  \justifying
  \begin{adjustwidth}{1ex}{1ex}
  \setlength{\parskip}{1ex}
  \vskip-2ex
}
\setbeamertemplate{block alerted end}{%
  \end{adjustwidth}
  \vskip1ex
  \end{beamercolorbox}
  \vskip0pt
  \vspace*{2ex}
}

% Example block
\setbeamertemplate{block example begin}{%
  \begin{beamercolorbox}[colsep*=0ex,dp=2ex,center]{block example title}
    \vskip0pt
    \usebeamerfont{block title}\insertblocktitle
    \vskip-1.25ex
    \begin{beamercolorbox}[colsep=0.025ex]{block example separator}\end{beamercolorbox}
  \end{beamercolorbox}
  {\parskip0pt\par}
  \usebeamerfont{block body}
  \vskip-0.5ex
  \begin{beamercolorbox}[colsep*=0ex]{block example body}
  \justifying
  \begin{adjustwidth}{1ex}{1ex}
  \setlength{\parskip}{1ex}
  \vskip-2ex
}
\setbeamertemplate{block example end}{%
  \end{adjustwidth}
  \vskip1ex
  \end{beamercolorbox}
  \vskip0pt
  \vspace*{2ex}
}

% Footer
\newcommand{\footercontent}[1]{\newcommand{\insertfootercontent}{#1}}
\newlength{\sepwidth}
\setlength{\sepwidth}{0.05\paperwidth}

\setbeamertemplate{footline}{
  \ifdefined\insertfootercontent
    \leavevmode
    \begin{beamercolorbox}[vmode, wd=\paperwidth]{footbox}
      \vspace{1ex}
      \begin{columns}[t,totalwidth=\paperwidth]
        \begin{column}{\sepwidth}
          % Empty left margin (same width as in headline)
        \end{column}
        \begin{column}{\dimexpr \paperwidth - \sepwidth - \sepwidth}
          \usebeamerfont{footline}%
          \usebeamercolor[fg]{primary}%
          \hypersetup{linkcolor=., citecolor=., urlcolor=., colorlinks=true}%
          \color{.}%
          \insertfootercontent
        \end{column}
        \begin{column}{\sepwidth}
          % Empty right margin (same width as in headline)
        \end{column}
      \end{columns}
      \vspace{1ex}
    \end{beamercolorbox}
  \fi
}
